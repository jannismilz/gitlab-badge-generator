<!DOCTYPE html>
<html>
  <head>
    <title>GitLab Badge Generator</title>
  </head>
  <body>
    <script>
      const params = new URLSearchParams(window.location.search);
      const labelText = (params.get('label') || 'stage').substring(0, 30);
      const statusText = (params.get('status') || 'status').substring(0, 30);
      const color = params.get('color') || '598bbc';

      function escapeXML(str) {
        return str.replace(/&/g, "&amp;")
                  .replace(/</g, "&lt;")
                  .replace(/>/g, "&gt;")
                  .replace(/"/g, "&quot;")
                  .replace(/'/g, "&apos;");
      }

      const labelEscaped = escapeXML(labelText);
      const statusEscaped = escapeXML(statusText);

      // Approximate text width for SVG
      const paddingX = 6;
      const charWidth = 8;
      const labelWidth = labelEscaped.length * charWidth + paddingX * 2;
      const statusWidth = statusEscaped.length * charWidth + paddingX * 2;
      const height = 20;
      const totalWidth = labelWidth + statusWidth;
      const radius = 10;
      const strokeWidth = 3;

      const svg = `
<svg xmlns="http://www.w3.org/2000/svg" width="${totalWidth}" height="${height}">
  <!-- Label -->
  <rect x="0" y="0" width="${labelWidth + 2}" height="${height}" fill="#${color}" ry="${radius}" clip-path="inset(0 ${radius - 2}px 0 0)" />
  
  <!-- Status -->
  <rect x="${labelWidth - 16}" y="0" width="${statusWidth}" height="${height}" fill="#18171d" ry="${radius}" clip-path="inset(0 0 0 ${radius}px)" stroke="#${color}" stroke-width="${strokeWidth}" />

  <!-- Text -->
  <text x="${labelWidth/2 - 2}" y="${height/2 + 4}" fill="#fff" font-family="Inter,sans-serif" font-size="12" text-anchor="middle">${labelEscaped}</text>
  <text x="${labelWidth + statusWidth/2 - 14}" y="${height/2 + 4}" fill="#fff" font-family="Inter,sans-serif" font-size="12" text-anchor="middle">${statusEscaped}</text>
</svg>
`;
    </script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
    </style>
  </body>
</html>
